var $colorsOptions,$densityPrice,$existenceOptions,$expectedOptions,docWidth,renderColorOptions,renderCount,renderDensityOptions,indexOf=[].indexOf;import{log,el,ev,makeObserveble,nodeObserver,els}from"/js/ksk-lib.js";import{store}from"/js/store.js";export var current=makeObserveble({density:null,color:null});store.addObserver(function(e,t,n){"dataFromServer"===t&&(n.addObserver(function(e,t,n){"density"===t&&renderDensityOptions()}),renderDensityOptions())});export var $options=el("#shirts .options");$densityPrice=el(".density-price",$options),(docWidth=document.documentElement.clientWidth)<=1200&&el("#shirts>div:last-child").prepend($options),renderDensityOptions=function(){var e,t,n,r,i,o,s,c,d,a,l;for(({density:i}=store.dataFromServer),t=document.createElement("ul"),s=0,d=i.length;s<d;s++)r=i[s],(e=document.createElement("li")).densityId=r.id,e.innerText=r.code+" г/м²",t.append(e);for($densityPrice.before(t),nodeObserver(t,{subtree:!0,attributes:!0,attributeFilter:["class"]},function(e){var t,n,o,s,c,d;if("attributes"===e.type&&"LI"===e.target.tagName&&e.target.classList.contains("active")){for(current.density=e.target.densityId,c=[(r=i.find(function(t){return t.id===e.target.densityId})).price,r.price_100,r.price_1000,r.price_1000-5],n=o=0,s=(d=els("li",$densityPrice)).length;o<s;n=++o)t=d[n],el("span:last-child",t).innerText=3===n?`${c[n]}₽ и ниже`:`${c[n]}₽`;renderColorOptions()}}),o=c=0,a=(l=els("li",t)).length;c<a;o=++c)n=l[o],0===o&&n.classList.add("active"),ev(n,"click",function(e){this.classList.contains("active")||(el(".active",t).classList.remove("active"),this.classList.add("active"))})},$colorsOptions=el(".color",$options),renderColorOptions=function(){var e,t,n,r,i,o,s,c,d,a,l,u,p,f;for((f=el("ul",$colorsOptions))&&f.remove(),p=store.dataFromServer.shirts.filter(function(e){return e.density_id===current.density}),i=new Set(function(){var e,t,n;for(n=[],e=0,t=p.length;e<t;e++)o=p[e],n.push(o.color_id);return n}()),r=function(){var e,t,n,r;for(r=[],e=0,t=(n=Array.from(i)).length;e<t;e++)o=n[e],r.push(store.dataFromServer.colors.find(function(e){return e.id===o}));return r}(),e=document.createElement("ul"),s=0,d=r.length;s<d;s++)n=r[s],(t=document.createElement("li")).colorId=n.id,t.style.backgroundColor="#"+n.hex,e.append(t);for($colorsOptions.append(e),nodeObserver(e,{subtree:!0,attributes:!0,attributeOldValue:!0},function(e){"attributes"===e.type&&"LI"===e.target.tagName&&e.target.classList.contains("active")&&(current.color=e.target.colorId,renderCount())}),l=els("li",e),u=[],o=c=0,a=l.length;c<a;o=++c)t=l[o],0===o&&t.classList.add("active"),u.push(ev(t,"click",function(t){this.classList.contains("active")||(el(".active",e).classList.remove("active"),this.classList.add("active"))}));return u},$existenceOptions=el(".existence",$options),$expectedOptions=el(".expected",$options),renderCount=function(){var e,t,n,r,i,o,s,c,d,a,l,u,p,f,v,m,h;for(p=store.dataFromServer.shirts.filter(function(e){return e.density_id===current.density&&e.color_id===current.color}),f=function(){var e,t,n;for(n=[],e=0,t=p.length;e<t;e++)s=p[e],n.push(s.id);return n}(),o=store.dataFromServer.expected.filter(function(e){var t;return t=e.shirt_id,indexOf.call(f,t)>=0}),m=store.dataFromServer.sizes,0===o.length?$expectedOptions.classList.add("empty"):$expectedOptions.classList.remove("empty"),(h=el("ul",$existenceOptions))&&h.remove(),e=document.createElement("ul"),c=0,a=p.length;c<a;c++)u=p[c],v=m.find(function(e){return e.id===u.size_id}).euro,(n=document.createElement("li")).innerHTML=`${v}: <span>${u.count} шт.</span>`,e.append(n);if($existenceOptions.append(e),(h=el("ul",$expectedOptions))&&h.remove(),o.length>0){for(t=document.createElement("ul"),d=0,l=o.length;d<l;d++)i=o[d],v=m.find(function(e){return e.id===p.find(function(e){return e.id===i.shirt_id}).size_id}).euro,r=new Date(i.date).toLocaleDateString("ru",{day:"numeric",month:"long",year:"numeric"}),(n=document.createElement("li")).innerHTML=`${v}: <span>${i.count} шт.</span> ${r}`,t.append(n);$expectedOptions.append(t)}};
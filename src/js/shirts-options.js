var $colorsOptions,$densityPrice,$existenceOptions,$expectedOptions,renderColorOptions,renderCount,renderDensityOptions,indexOf=[].indexOf;import{log,el,ev,makeObserveble,nodeObserver,els}from"/js/ksk-lib.js";import{store}from"/js/store.js";export var current=makeObserveble({density:null,color:null});store.addObserver(function(e,t,r){"dataFromServer"===t&&(r.addObserver(function(e,t,r){"density"===t&&renderDensityOptions()}),renderDensityOptions())});export var $options=el("#shirts .options");$densityPrice=el(".density-price",$options),renderDensityOptions=function(){var e,t,r,n,i,s,o,c,a,d,l;for(({density:i}=store.dataFromServer),t=document.createElement("ul"),o=0,a=i.length;o<a;o++)n=i[o],(e=document.createElement("li")).densityId=n.id,e.innerText=n.code+" г/м²",t.append(e);for($densityPrice.before(t),nodeObserver(t,{subtree:!0,attributes:!0,attributeFilter:["class"]},function(e){var t,r,i,s,o,c;if("attributes"===e.type&&"LI"===e.target.tagName&&e.target.classList.contains("active")){for(current.density=e.target.densityId,o=[(n=store.dataFromServer.density.find(function(e){return e.id===current.density})).price,n.price_100,n.price_1000,n.price_1000-5],r=i=0,s=(c=els("li",$densityPrice)).length;i<s;r=++i)t=c[r],el("span:last-child",t).innerText=3===r?`${o[r]}₽ и ниже`:`${o[r]}₽`;renderColorOptions()}}),s=c=0,d=(l=els("li",t)).length;c<d;s=++c)r=l[s],0===s&&r.classList.add("active"),ev(r,"click",function(e){this.classList.contains("active")||(el(".active",t).classList.remove("active"),this.classList.add("active"))})},$colorsOptions=el(".color",$options),renderColorOptions=function(){var e,t,r,n,i,s,o,c,a,d,l,u,p,f;for((f=el("ul",$colorsOptions))&&f.remove(),p=store.dataFromServer.shirts.filter(function(e){return e.density_id===current.density}),i=new Set(function(){var e,t,r;for(r=[],e=0,t=p.length;e<t;e++)s=p[e],r.push(s.color_id);return r}()),n=function(){var e,t,r,n;for(n=[],e=0,t=(r=Array.from(i)).length;e<t;e++)s=r[e],n.push(store.dataFromServer.colors.find(function(e){return e.id===s}));return n}(),e=document.createElement("ul"),o=0,a=n.length;o<a;o++)r=n[o],(t=document.createElement("li")).colorId=r.id,t.style.backgroundColor="#"+r.hex,e.append(t);for($colorsOptions.append(e),nodeObserver(e,{subtree:!0,attributes:!0,attributeOldValue:!0},function(e){"attributes"===e.type&&"LI"===e.target.tagName&&e.target.classList.contains("active")&&(current.color=e.target.colorId,renderCount())}),l=els("li",e),u=[],s=c=0,d=l.length;c<d;s=++c)t=l[s],0===s&&t.classList.add("active"),u.push(ev(t,"click",function(t){this.classList.contains("active")||(el(".active",e).classList.remove("active"),this.classList.add("active"))}));return u},$existenceOptions=el(".existence",$options),$expectedOptions=el(".expected",$options),renderCount=function(){var e,t,r,n,i,s,o,c,a,d,l,u,p,f,v,m,O;for(p=store.dataFromServer.shirts.filter(function(e){return e.density_id===current.density&&e.color_id===current.color}),f=function(){var e,t,r;for(r=[],e=0,t=p.length;e<t;e++)o=p[e],r.push(o.id);return r}(),s=store.dataFromServer.expected.filter(function(e){var t;return t=e.shirt_id,indexOf.call(f,t)>=0}),m=store.dataFromServer.sizes,0===s.length?$expectedOptions.classList.add("empty"):$expectedOptions.classList.remove("empty"),(O=el("ul",$existenceOptions))&&O.remove(),e=document.createElement("ul"),c=0,d=p.length;c<d;c++)u=p[c],v=m.find(function(e){return e.id===u.size_id}).euro,(r=document.createElement("li")).innerHTML=`${v}: <span>${u.count} шт.</span>`,e.append(r);if($existenceOptions.append(e),(O=el("ul",$expectedOptions))&&O.remove(),s.length>0){for(t=document.createElement("ul"),a=0,l=s.length;a<l;a++)i=s[a],v=m.find(function(e){return e.id===p.find(function(e){return e.id===i.shirt_id}).size_id}).euro,n=new Date(i.date).toLocaleDateString("ru",{day:"numeric",month:"long",year:"numeric"}),(r=document.createElement("li")).innerHTML=`${v}: <span>${i.count} шт.</span> ${n}`,t.append(r);$expectedOptions.append(t)}};
var $colorsOptions,$densityPrice,$options,renderColorOptions,renderCount,renderDensityOptions;import{log,el,ev,makeObserveble,els}from"/js/ksk-lib.js";import{store}from"/js/store.js";export var current=makeObserveble({density:null,color:null});store.addObserver(function(e,t,r){"dataFromServer"===t&&(r.addObserver(function(e,t,r){"density"===t&&renderDensityOptions()}),renderDensityOptions())}),$options=el("#shirts .options"),$densityPrice=el(".density-price",$options),renderDensityOptions=function(){var e,t,r,n,i,s,o,a,c,l,d;for(({density:i}=store.dataFromServer),t=document.createElement("ul"),o=0,c=i.length;o<c;o++)n=i[o],(e=document.createElement("li")).densityId=n.id,e.innerText=n.code,t.append(e);for($densityPrice.before(t),new MutationObserver(function(e){var t,r,i,s,o,a,c,l,d;for(r=i=0,o=e.length;i<o;r=++i)if("attributes"===(c=e[r]).type&&"LI"===c.target.tagName&&c.target.classList.contains("active")){for(current.density=c.target.densityId,l=[(n=store.dataFromServer.density.find(function(e){return e.id===current.density})).price,n.price_100,n.price_1000,n.price_1000-5],r=s=0,a=(d=els("li",$densityPrice)).length;s<a;r=++s)t=d[r],el("span:last-child",t).innerText=3===r?`${l[r]}₽ и ниже`:`${l[r]}₽`;renderColorOptions()}}).observe(t,{subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["class"]}),s=a=0,l=(d=els("li",t)).length;a<l;s=++a)r=d[s],0===s&&r.classList.add("active"),ev(r,"click",function(e){this.classList.contains("active")||(el(".active",t).classList.remove("active"),this.classList.add("active"))})},$colorsOptions=el(".color",$options),renderColorOptions=function(){var e,t,r,n,i,s,o,a,c,l,d,u,v,p;for((p=el("ul",$colorsOptions))&&p.remove(),v=store.dataFromServer.shirts.filter(function(e){return e.density_id===current.density}),i=new Set(function(){var e,t,r;for(r=[],e=0,t=v.length;e<t;e++)s=v[e],r.push(s.color_id);return r}()),n=(n=[function(){var e,t,r,n;for(n=[],e=0,t=(r=Array.from(i)).length;e<t;e++)s=r[e],n.push(store.dataFromServer.colors.find(function(e){return e.id===s}));return n}()])[0],e=document.createElement("ul"),o=0,c=n.length;o<c;o++)r=n[o],(t=document.createElement("li")).colorId=r.id,t.style.backgroundColor="#"+r.hex,e.append(t);for($colorsOptions.append(e),new MutationObserver(function(e){var t,r,n;for(t=0,r=e.length;t<r;t++)"attributes"===(n=e[t]).type&&"LI"===n.target.tagName&&n.target.classList.contains("active")&&(current.color=n.target.colorId,renderCount())}).observe(e,{subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["class"]}),d=els("li",e),u=[],s=a=0,l=d.length;a<l;s=++a)t=d[s],0===s&&t.classList.add("active"),u.push(ev(t,"click",function(t){this.classList.contains("active")||(el(".active",e).classList.remove("active"),this.classList.add("active"))}));return u},renderCount=function(){var e;store.dataFromServer.shirts.filter(function(e){return e.density_id===current.density&&e.color_id===current.color}),e=store.dataFromServer.expected,log(new Date(e[0].date))};
var $colorsOptions,$densityPrice,$existenceOptions,$expectedOptions,docWidth,renderColorOptions,renderCount,renderDensityOptions,indexOf=[].indexOf;import{log,el,ev,makeObserveble,nodeObserver,els}from"/js/ksk-lib.js";import{store}from"/js/store.js";export var current=makeObserveble({density:null,color:null});store.addObserver(function(e,t,r){"dataFromServer"===t&&(r.addObserver(function(e,t,r){"density"===t&&renderDensityOptions()}),renderDensityOptions())});export var $options=el("#shirts .options");$densityPrice=el(".density-price",$options),(docWidth=document.documentElement.clientWidth)<=1200&&el("#shirts>div:last-child").prepend($options),renderDensityOptions=function(){var e,t,r,n,i,o,s,c,d,a,l;for(({density:i}=store.dataFromServer),t=document.createElement("ul"),s=0,d=i.length;s<d;s++)n=i[s],(e=document.createElement("li")).densityId=n.id,e.innerText=n.code+" г/м²",t.append(e);for($densityPrice.before(t),nodeObserver(t,{subtree:!0,attributes:!0,attributeFilter:["class"]},function(e){var t,r,i,o,s,c;if("attributes"===e.type&&"LI"===e.target.tagName&&e.target.classList.contains("active")){for(current.density=e.target.densityId,s=[(n=store.dataFromServer.density.find(function(e){return e.id===current.density})).price,n.price_100,n.price_1000,n.price_1000-5],r=i=0,o=(c=els("li",$densityPrice)).length;i<o;r=++i)t=c[r],el("span:last-child",t).innerText=3===r?`${s[r]}₽ и ниже`:`${s[r]}₽`;renderColorOptions()}}),o=c=0,a=(l=els("li",t)).length;c<a;o=++c)r=l[o],0===o&&r.classList.add("active"),ev(r,"click",function(e){this.classList.contains("active")||(el(".active",t).classList.remove("active"),this.classList.add("active"))})},$colorsOptions=el(".color",$options),renderColorOptions=function(){var e,t,r,n,i,o,s,c,d,a,l,u,p,v;for((v=el("ul",$colorsOptions))&&v.remove(),p=store.dataFromServer.shirts.filter(function(e){return e.density_id===current.density}),i=new Set(function(){var e,t,r;for(r=[],e=0,t=p.length;e<t;e++)o=p[e],r.push(o.color_id);return r}()),n=function(){var e,t,r,n;for(n=[],e=0,t=(r=Array.from(i)).length;e<t;e++)o=r[e],n.push(store.dataFromServer.colors.find(function(e){return e.id===o}));return n}(),e=document.createElement("ul"),s=0,d=n.length;s<d;s++)r=n[s],(t=document.createElement("li")).colorId=r.id,t.style.backgroundColor="#"+r.hex,e.append(t);for($colorsOptions.append(e),nodeObserver(e,{subtree:!0,attributes:!0,attributeOldValue:!0},function(e){"attributes"===e.type&&"LI"===e.target.tagName&&e.target.classList.contains("active")&&(current.color=e.target.colorId,renderCount())}),l=els("li",e),u=[],o=c=0,a=l.length;c<a;o=++c)t=l[o],0===o&&t.classList.add("active"),u.push(ev(t,"click",function(t){this.classList.contains("active")||(el(".active",e).classList.remove("active"),this.classList.add("active"))}));return u},$existenceOptions=el(".existence",$options),$expectedOptions=el(".expected",$options),renderCount=function(){var e,t,r,n,i,o,s,c,d,a,l,u,p,v,f,m,h;for(p=store.dataFromServer.shirts.filter(function(e){return e.density_id===current.density&&e.color_id===current.color}),v=function(){var e,t,r;for(r=[],e=0,t=p.length;e<t;e++)s=p[e],r.push(s.id);return r}(),o=store.dataFromServer.expected.filter(function(e){var t;return t=e.shirt_id,indexOf.call(v,t)>=0}),m=store.dataFromServer.sizes,0===o.length?$expectedOptions.classList.add("empty"):$expectedOptions.classList.remove("empty"),(h=el("ul",$existenceOptions))&&h.remove(),e=document.createElement("ul"),c=0,a=p.length;c<a;c++)u=p[c],f=m.find(function(e){return e.id===u.size_id}).euro,(r=document.createElement("li")).innerHTML=`${f}: <span>${u.count} шт.</span>`,e.append(r);if($existenceOptions.append(e),(h=el("ul",$expectedOptions))&&h.remove(),o.length>0){for(t=document.createElement("ul"),d=0,l=o.length;d<l;d++)i=o[d],f=m.find(function(e){return e.id===p.find(function(e){return e.id===i.shirt_id}).size_id}).euro,n=new Date(i.date).toLocaleDateString("ru",{day:"numeric",month:"long",year:"numeric"}),(r=document.createElement("li")).innerHTML=`${f}: <span>${i.count} шт.</span> ${n}`,t.append(r);$expectedOptions.append(t)}};